\chapter{Motorprüfstand des IAT}\label{cha:motorprüfstand}
%
Die experimentelle Untersuchung des Versuchsmotors erfolgt am hochdynamischen Motorprüfstand des Instituts für Automatisierungstechnik der TU Darmstadt \ref{fig:Motopruefstand_cropped}. Es handelt sich dabei um einen modern ausgestatteten Prüfstand bei dem die Versuchsträger auf Rollenwagen aufgebaut und mit Schnellkupplungen für die Kraftstoff- und Kühlwasserversorgung versehen sind. Das Rollenwagenkonzept ermöglicht einen Austausch der Versuchsmotoren in kürzester Zeit.

Eine Asynchronmaschine zählt zu den weiteren Bestandsteile des Prüfstands, denn durch sie erfolgt die Belastung des Motors.
Diese wird üblicherweise drehzahlgeregelt betrieben. Sie erzeugt abhängig vom gewählten Motorbetriebspunkt ein positives oder negatives Belastungsmoment (generatorischer bzw. motorischer Betrieb). Die Momentenanregelzeit des Systems aus Umrichter und Asynchronmaschine liegt unter 5ms. Der Prüfstand ist damit insbesondere für die Untersuchung dynamischer Fahrzustände geeignet. 

Ein RCP-System\footnote{engl. Rapid Control Prototyping} steuert den Frequenzumrichter der Asynchronmaschine, die Abgasanlage, die Messtechnik und regelt das Kühlsystem~\cite{Zahn}.
%
\chapter{Verwendeter Dieselmotor und entsprechendes Simulationsmodell}\label{cha:verbrennungsmotorDaten}
%
\section{Motordaten}
%
Der Versuchsmotor ist ein Opel/Fiat 1.9l Common-Rail Dieselmotor. Es ist mit einer Hochdruckabgasrückführung und einem Abgasturbolader mit variablen Turbinengeometrie ausgestattet. Eine Niederdruckabgasrückführung-Einrichtung wurde nachträglich eingebaut.

%
\begin{minipage}{0.35\textwidth}
%\includegraphics [width=\columnwidth]{}
\end{minipage}
\begin{minipage}{0.35\textwidth}
\begin{tabular}{|l|l|}
\hline
Hersteller & GM/Opel und Fiat \\
Motorbezeichnung & Z19DTH (4V) \\
Kreisprozess & Viertaktmotor \\
Zylinderzahl & 4 \\
Hubraum & 1910 $cm^3$ \\
Verdichtungsverhältnis & 17.5 \\
Max. Leistung(bei 4000 $min^{-1}$) & 110 kW \\
Max. Drehmoment(bei 2000 $min^{-1}$) & 315 Nm \\
Leerlaufdrehzahl & 850 $min^{-1}$ \\
Maximale Drehzahl & 5100 $min^{-1}$ \\
\hline 
\end{tabular}
\end{minipage}
%
\section{Verwendetes Simulink-Modell des Dieselverbrennungsmotors}
%
In Abbildung \ref{fig:gesamtModellSim} ist der modellierte Dieselmotor dargestellt. Das links im Bild gelegene Luftpfadmodell liefert dem Verbrennungsmodell (rechte Seite) die entsprechenden Luftpfadsgrößen Gaszusammensetzung $x_{2EB}$ bzw. $x_3$, die Temperatur $T_{2EB}$ bzw. $T_3$ und die Drücke $P_{2EB}$ bzw. $P_3$ des jeweiligen Einlass- und Auslassbehälters. Das Verbrennungsmodell führt nach einem Arbeitsspiel die berechnete SPL zurück zum Luftpfadmodell.
%
\begin{figure}[!ht]
\centering
%\includegraphics [angle=90,scale=0.8]{}
\caption{gesamtes Simulink-Modell des Verbrennungsmotors}
\label{fig:gesamtModellSim}
\end{figure}
%
\chapter{Softwaredokumentation}\label{cha:tools}
%
Im Rahmen dieser Arbeit sind folgende Software-Tools entwickelt worden:
\begin{itemize}
\item \textbf{Schwerpunktlage der Verbrennung} \\
\verb+SPL = function_SPL(phi_mod,QB,abtastzeit_s,nMot)+ berechnet.
\item \textbf{Zylinderdruckgradient} \\
 \verb+[dp_dphi,ddp_ddphi]  = Grad_dGrad_pZMax(phi,pZ)+
\end{itemize}
%
Die oben genannten Tools werden im Folgenden näher erläutert.
%
\section{Berechnung der Schwerpunktlage der Verbrennung $\phi_{Q50}$}
%
Um die Kenngröße SPL in Echtzeit ermitteln zu können, sind die momentanen Werte des simulierten integralen Brennverlaufs $Q_B$ und des Kurbelwinkels $\phi$ nötig. Diese Kenngrößen werden vom Verbrennungsmodell ermittelt und können dementsprechend benutzt werden. In Abbildung \ref{fig:Schwerpunktlage} ist die entsprechende Embendded MATLAB Function zu erkennen, mit deren Hilfe die SPL berechnet wird. Der jeweilige Quellcode wird im Listing \ref{lst:SPL} aufgezeigt.

%
\begin{figure}[htp]
\centering
%\includegraphics[scale=0.5]{}
\caption{Embendded-MATLAB Function zur Berechnung der Schwerpunktlage der Verbrennung $\phi_{Q50}$}
\label{fig:Schwerpunktlage}
\end{figure}
%
\begin{lstlisting}[style=Matlab_colored, caption = {Embendded MATLAB Function},label={lst:SPL}]

function SPL = function_SPL(phi_mod,QB,abtastzeit_s,nMot)
%#codegen

abtastzeit_radKW=2*pi*nMot*abtastzeit_s/60;	% Abtastzeit Sek. -> rad KW 
Anzahl_abtast_radKW=ceil(4*pi/abtastzeit_radKW); % Gesamte Anzahl Abtastschritte in rad KW

persistent QB_toSave phi_toSave counter SPL_persistent hilfe_phi

if isempty(QB_toSave)      % Initialisierung der persistent-Variablen
    QB_toSave=zeros(Anzahl_abtast_radKW+3,1);	
    hilfe_phi=0;    
    counter=1;
end

if isempty(phi_toSave)     % Initialisierung der persistent-Variablen
    SPL_persistent=0; 
    probe=0;
    phi_toSave=zeros(Anzahl_abtast_radKW+3,1);
    
end

if phi_mod == 0 % Die relevanten Daten werden bei phi_mod==0 nur einmal gespeichert.
    QB_toSave(counter,1) = QB;
    phi_toSave(counter,1) = phi_mod;
    hilfe_phi=phi_mod;	% Diese Variable hilft dabei, das Ende eines Arbeitsspiels zu erkennen.
    counter=counter+1;

elseif hilfe_phi < phi_mod	% Ist ein Arbeitsspiel noch nicht vorbei, dann werden die relevanten Daten weiter gespeichert. 																					
    QB_toSave(counter,1) = QB;                          
    phi_toSave(counter,1) = phi_mod;
    hilfe_phi=phi_mod;
    counter=counter+1;
    
elseif hilfe_phi > phi_mod % Ist ein Arbeitsspiel vorbei, dann wird aus den gespeicherten Daten die SPL berechnet.
    
    check=max(QB_toSave)/2;	% Die Hälfte des integralen Heizverlaufs wird bestimmt.
    
    for i=1:counter			% Der Index wird gesucht, bei dem die Hälfte des int. Brennverlauf gespeichert wurde. Anschiessend wird dieser Index benutzt, um die SPL zu bestimmen.
        if(QB_toSave(i,1) > check)	% 
            SPL_persistent=(phi_toSave(i,1)-pi)*180/pi;	% SPL wird als °KW ausgegeben
            hilfe_phi=phi_mod;
            counter=1;
            break;
        elseif (i==counter)		% Diese if-Anfrage, hilft dabei, die Variablen neu zu setzen, falls bei der 1. if-Anfrage die SPL nicht gefunden werden konnte.
            hilfe_phi=phi_mod; 
            QB_toSave=zeros(Anzahl_abtast_radKW+3,1);
            counter=1;
            SPL_persistent=0;
            phi_toSave=zeros(Anzahl_abtast_radKW+3,1);
        end
    end
end
SPL=SPL_persistent;	% SPL wird ausgegeben

\end{lstlisting}
%
\newpage
\section{Berechnung des Druckgradienten}
%
Für die Echtzeitbestimmung der Kenngrößen Druckgradientenverlauf $\frac{dp}{d\phi}$ und deren zeitlichen Ableitung $\frac{d^2p}{d\phi^2}$ sind die momentanen Werte des simulierten Zylinderdrucks $p_Z$ und des Kurbelwinkels $\phi$ nötig. Diese Kenngrößen werden vom Verbrennungsmodell ermittelt und können dementsprechend verarbeitet werden. In Abbildung \ref{fig:DruckgradSimulink} ist die entsprechende Embendded MATLAB Function zu erkennen. Der jeweilige Quellcode wird im Listing \ref{lst:Druckgrad} aufgezeigt.
%
\begin{figure}[htp]
\centering
%\includegraphics[scale=0.5]{}
\caption{Embendded-MATLAB Function zur Berechnung des Druckgradienten $\frac{dp_{z}}{d\phi}$}
\label{fig:DruckgradSimulink}
\end{figure}
%
\begin{lstlisting}[style=Matlab_colored, caption = {Embendded MATLAB Function},label={lst:Druckgrad}]
function [dp_dphi,ddp_ddphi]  = Grad_dGrad(phi,pZ)
%#codegen

persistent counter phi_toSave pZ_toSave dp_toSave

if isempty(counter)	% persistent-Variablen werden initialisiert.
    counter=0;
    phi_toSave=phi;
    pZ_toSave=pZ;  
    dp_toSave=0;
end

if (counter == 1) && (phi > phi_toSave)    % Ab hier beginnt die Gradientenbestimmung.
    dp_dphi=(pZ_toSave-pZ)/(phi_toSave-phi);	% Alleresrte Druckgradientbestimmung.
    dp_toSave=dp_dphi;			% Vorherige relevante Werte werden gepeichert.
    pZ_toSave=pZ;
    phi_toSave=phi;
    counter=counter+1;
    return
elseif (counter == 2) && (phi > phi_toSave)	% Ab hier beginnt die 2. zeitliche Ableitung des Drucks, gleichzeitig wird die Druckgradientbestimmung fortgefahren.
    dp_dphi=(pZ_toSave-pZ)/(phi_toSave-phi); % Druckgradientenbestimmung.
    ddp_ddphi=(dp_toSave-dp_dphi)/(phi_toSave-phi); % 2. zeitliche Ableitung des Drucks.
    dp_toSave=dp_dphi;
    pZ_toSave=pZ;
    phi_toSave=phi;    
    return
elseif counter == 0	% Anfangswerte von Hilfsvariablen werden festgelegt.
   counter=counter+1;
   dp_dphi=0; 
   ddp_ddphi=0;
   return
end
dp_dphi=0;		% Falls ein Fehler auftritt, betragen beide Kenngröße 0.
ddp_ddphi=0;
\end{lstlisting}
%
\chapter{Prüfstandsmessdaten}\label{cha:PruefMess}
%
In folgender Tabelle sind sowohl die Luftpfadsgrößen des Einlassbehälters als auch der Winkel der Haupteinpritzung aufgelistet, die im Betriebspunkt ($n_{mot}=1500min^{-1}$; $q_{inj}=10mm^3/inj$) variiert und vermessen wurden.
%
\begin{longtable}{|l|l|l|l|l|l|l|}
\hline
Messung Nr. & $s\phi_{HE}$[°KW v.OT] & $\lambda$ & $T_{2EB}$[K] & $\frac{dm_L}{dt}[\frac{kg}{s}]$ & $\frac{dm_{Gas}}{dt}[\frac{kg}{s}]$ & $x_{AGR}$ [-]\\
\endhead
\multicolumn{7}{c}{}\\
\hline
Messung Nr. & $s\phi_{HE}$[°KW v.OT] & $\lambda$ & $T_{2EB}$[K] & $\frac{dm_L}{dt}[\frac{kg}{s}]$ & $\frac{dm_{Gas}}{dt}[\frac{kg}{s}]$ & $x_{AGR}$ [-]\\
\hline
\endfirsthead
\multicolumn{7}{c}{}
\endfoot
\multicolumn{7}{c}{}
\endlastfoot
1 & -1 & 4.8 & 291 & 0.024 & 0.024 & 0 \\
\hline
2 & 1 & 3.7  & 291.4 & 0.024 & 0.024 & 0 \\
\hline
3 & 3 & 3.6  & 291.4 & 0.024 & 0.024 & 0 \\
\hline
4 & 5 & 3.58  & 291.6 & 0.024 & 0.024 & 0 \\
\hline
5 & 7 & 3.55  & 291.3 & 0.024 & 0.024 & 0 \\
\hline
6 & 9 & 3.52 & 291.2 & 0.024 & 0.024 & 0 \\
\hline
7 & 11 & 3.56  & 291.5 & 0.024 & 0.024 & 0 \\
\hline
 &  &  &  &  &  &  \\
\hline
8 & 1 & 3.35  & 291.5 & 0.02 & 0.025 & 0.2  \\
\hline
9 & 3 & 3.1  & 292.3 & 0.02 & 0.025 & 0.2  \\
\hline
10 & 5 & 3.03  & 292.5 & 0.02& 0.025 & 0.2  \\
\hline
11 & 7 & 3   & 292.2 &  0.02&0.025& 0.2  \\
\hline
12 & 9 & 3   & 291.8 &  0.02& 0.025 & 0.2  \\
\hline
13 & 11 & 3   & 291.9 &  0.02& 0.025 & 0.2  \\
\hline
 &  &  &  &  &  &  \\
\hline
14 & 1 & 2.3  & 338 & 0.013 & 0.022 & 0.041  \\
\hline
15 & 3 & 2.09  & 340.2 & 0.013 &0.022 & 0.041  \\
\hline
16 & 5 & 2.06  & 340.8 & 0.013 & 0.022 & 0.041  \\
\hline
17 & 7 & 2.03  & 330 & 0.013 & 0.022 & 0.041  \\
\hline
18 & 9 & 1.98  & 338 & 0.013 & 0.022 & 0.041  \\
\hline
19 & 11 & 2.02  & 337 & 0.013 & 0.022 & 0.041 \\
\hline
20 & 13 & 2.04  & 336 & 0.013 & 0.022 & 0.041  \\
\hline
21 & 15 & 2.06  & 335.5 & 0.013 & 0.022 & 0.041  \\
\hline
 &  &  &  &  &  &  \\
\hline
22 & 5 & 1.92  & 3.5 & 0.01 & 0.023 & 0.565  \\
\hline
23 & 7 & 1.71  & 315.5 & 0.01 & 0.023 & 0.565   \\
\hline
24 & 9 & 1.62  & 315 & 0.01 & 0.023 & 0.565   \\
\hline
25 & 11 & 1.62  & 315 & 0.01 & 0.023 & 0.565   \\
\hline
26 & 13 & 1.64  & 313 &0.01& 0.023 & 0.565   \\
\hline
27 & 15 & 1.65  & 313 & 0.01& 0.023 & 0.565   \\
\hline
28 & 17 & 1.68  & 312.5 & 0.01& 0.023 & 0.565   \\
\hline
29 & 19 & 1.68  & 313 & 0.01 & 0.023 & 0.565   \\
\hline
30 & 21 & 1.7  & 313 & 0.01 & 0.023 & 0.565   \\
\hline
 &  &  &  &  &  &  \\
\hline
31 & 19 & 1.33  & 338 & 0.008 & 0.021 & 0.62  \\
\hline
32 & 21& 1.34  & 338 & 0.008 & 0.021 & 0.62  \\
\hline
33 & 23& 1.36  & 338 & 0.008 & 0.021 & 0.62  \\
\hline
34 & 25& 1.36  & 338 & 0.008 & 0.021 & 0.62  \\
\hline
35 & 27& 1.36  & 336 & 0.008 & 0.021 & 0.62  \\
\hline
36 & 29 & 1.37  & 337 & 0.008 & 0.021 & 0.62  \\
\hline
\caption{Luftpfadsgrößen des Einlassbehälters und Winkel der Haupteinpritzung, bei denen die Druckverläufe am Prüfstand gemessen wurden. Betriebspunkt ($n_{mot}=1500min^{-1}$; $q_{inj}=10mm^3/inj$).}
\label{tab:TabPruef}
\end{longtable}

