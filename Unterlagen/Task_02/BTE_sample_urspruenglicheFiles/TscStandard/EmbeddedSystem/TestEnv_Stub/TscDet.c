/***********************************************************************************************************************
 *  COPYRIGHT
 *  -------------------------------------------------------------------------------------------------------------------
 *  \verbatim
 *  Copyright (c) 2015 by Vector Informatik GmbH.                                               All rights reserved.
 *
 *                This software is copyright protected and proprietary to Vector Informatik GmbH.
 *                Vector Informatik GmbH grants to you only those rights as set out in the license conditions.
 *                All other rights remain with Vector Informatik GmbH.
 *  \endverbatim
 * --------------------------------------------------------------------------------------------------------------------
 *  FILE DESCRIPTION
 * ------------------------------------------------------------------------------------------------------------------*/
/**     \file  TscDet.c
 *     \brief  TscStub source file for Det
 *   \details  
 **********************************************************************************************************************/

/***********************************************************************************************************************
 *  REVISION HISTORY
 *  -------------------------------------------------------------------------------------------------------------------
 *  Refer to the module's header file.
 *
 *  FILE VERSION
 *  -------------------------------------------------------------------------------------------------------------------
 *  Refer to the VERSION CHECK below.
 **********************************************************************************************************************/

#define MIP_SOURCE

/***********************************************************************************************************************
 *  INCLUDES
 **********************************************************************************************************************/
#include <stdio.h>
#include "TscDet.h"
#include "BteLog.h"

/***********************************************************************************************************************
 *  VERSION CHECK
 **********************************************************************************************************************/
#if ( (TSCDET_MAJOR_VERSION != 1) || \
      (TSCDET_MINOR_VERSION != 0) || \
      (TSCDET_RELEASE_VERSION != 0))
#error "Header and Source file are inconsistent (version)!"
#endif


/***********************************************************************************************************************
 *  LOCAL CONSTANT MACROS
 **********************************************************************************************************************/

/***********************************************************************************************************************
 *  LOCAL FUNCTION MACROS
 **********************************************************************************************************************/

/***********************************************************************************************************************
 *  LOCAL DATA TYPES AND STRUCTURES
 **********************************************************************************************************************/

/***********************************************************************************************************************
 *  LOCAL DATA
 **********************************************************************************************************************/
/*--- stub function control data ------------------------------------------------------------------------------------*/
static uint8 DetIsError;

/***********************************************************************************************************************
 *  GLOBAL DATA
 **********************************************************************************************************************/

/***********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 **********************************************************************************************************************/
static void TscDet_Event_Init( tBteEvent *pEvent );
static void TscDet_Event_Log( tBteEvent *pEvent );

/***********************************************************************************************************************
 *  LOCAL FUNCTIONS
 **********************************************************************************************************************/
/***********************************************************************************************************************
  Name:        TscDet_Event_Init
  Description: 
***********************************************************************************************************************/
static void TscDet_Event_Init( tBteEvent *pEvent)
{
  BteEvent_Init( pEvent );
  pEvent->comp = kTscDet_CI;
  DetIsError = 1;
}
/***********************************************************************************************************************
  Name:        TscDet_Event_Log
  Description: 
***********************************************************************************************************************/
static void TscDet_Event_Log( tBteEvent *pEvent)
{
  if (pEvent->type == kBteEventType_Command || pEvent->type == kBteEventType_Command)
  {
    pEvent->caller = kTscDet_CI;
  }
  else if (pEvent->type == kBteEventType_Default)
  {
    pEvent->callee = kTscDet_CI;
  }
  BteLog_Event_Log( pEvent );
}

/***********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 **********************************************************************************************************************/
/*--- standard BTE function definition ------------------------------------------------------------------------------*/
/***********************************************************************************************************************
  Name:        TscDet_Init
  Description: 
***********************************************************************************************************************/
void TscDet_Init( void)
{
  BteLog_SetStubName(kTscDet_CI,"Det");
  TscDet_EventMask_EnableAll();

  /*--- init stub function control data ---*/

}
/***********************************************************************************************************************
  Name:        TscDet_Cyclic1ms
  Description: 
***********************************************************************************************************************/
void TscDet_Cyclic1ms( void)
{
}

#define DET_CODE
/*--- wrapper function definition -----------------------------------------------------------------------------------*/

/*--- stub function definition --------------------------------------------------------------------------------------*/
/***********************************************************************************************************************
 *  Det_ReportError
 **********************************************************************************************************************/
FUNC(void, DET_CODE) Det_ReportError( uint16 ModuleId, uint8 InstanceId, uint8 ApiId, uint8 ErrorId )
{
  tBteEvent evnt;

  /*--- event logging ---*/
  TscDet_Event_Init( &evnt );
  evnt.code = kTscDet_Det_ReportError;
  evnt.data1 = (uint32)ModuleId;
  evnt.data2 = (uint32)InstanceId;
  evnt.data3 = (uint32)ApiId;
  evnt.data4 = (uint32)ErrorId;
  (void)sprintf( evnt.text_name, "Det_ReportError" );
  (void)sprintf( evnt.text_param, "(ModuleId=%d, InstanceId=%d, ApiId=%d, ErrorId=%d)", ModuleId, InstanceId, ApiId, ErrorId);
  TscDet_Event_Log( &evnt );

  /*--- test handling ---*/
  /* N/A */
  if( DetIsError == 1 )
  {
    BteError("DET Error");
  }

}

void TscDet_SetDetAsError( uint8 value )
{
  DetIsError = value;
}


/*--- stub function control definition ------------------------------------------------------------------------------*/

/*--- stub assert event function definition -------------------------------------------------------------------------*/


/***********************************************************************************************************************
 *  END OF FILE
 **********************************************************************************************************************/

